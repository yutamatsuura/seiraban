#!/usr/bin/env python3
import re

# 実際のraw_textから五行による鑑定セクションを抽出する
actual_raw_text = """
    姓名鑑定
    管理者用


            このサイトの姓名鑑定は読み下し、五行、陰陽、天地の配合、画数で鑑定を行います。


            一般的な画数だけで見る鑑定とは違い、人生・体質・人間関係・社会との関係性など細かく鑑定します。


            単純な鑑定方法でないため、個別での鑑定と比べ精度は落ちますが
            ご自身の名前を深く知るきっかけになれば幸いです。




    姓：
    名： 姓名鑑定

     文字の構成
                    松

                    浦

                    百

                    花
                 画数
                    8

                    10

                    6

                    8
                 五行
                    金

                    水

                    水

                    木
                 陽陰
                    陰

                    陰

                    陰

                    陰
                 天格
                    18


                 人格


                    16


                 地格


                    14
                 総画
                    32
                 鑑定の結果 総評
                    5点

                        /100

                コメントが付く項目が多いので、苦労の人生になることが多いです。コメントをご覧の上、選名をお勧めします。
             文字による鑑定 百
                【地行が水行】
             水性はご自身がやってきたことを水に流し、努力が報われず、体を壊します。苦労の連続となりやすいです。花  文字の由来・意味から名前には使用しないほうがいい文字です。花  名前には使用できない文字です。人生に実り少なく早く枯れてしまう。または変化に翻弄され苦労の連続となりがちです。 陰陽による鑑定 松浦 百花
                【黒の方寄り】
             根暗で、人とコミュニケーションを取るのが苦手な傾向にあります。物事の白黒をはっきりさせたい気持ちが強くなります。人生の良い時期と悪い時期がはっきりしています。大事な時に体を壊しやすいです。 五行による鑑定 人格：浦百
                【水-水】
             中年期（28歳～50歳）までの運勢は大凶。人間関係で成したことがすべて流れてしまう。詐欺など人に騙された経験があり人が信用できない。人間関係の広がりがない。また、濃い関係になればなるほどトラブルが起こりやすく、苦労の人生となります。腎臓、肝臓に不調が出やすく、性病にかかりやすいです。松浦
"""

print("実際のraw_textから五行による鑑定セクションを抽出します...")
print("=" * 60)

# 実際のバックエンドロジックを使用
def extract_gogyou_section(raw_text):
    # 五行による鑑定のセクションを抽出（更新されたロジック）
    gogyou_section_match = re.search(r'五行による鑑定\s*(.+?)(?:陰陽による鑑定|画数による鑑定|$)', raw_text, re.DOTALL)
    if gogyou_section_match:
        return gogyou_section_match.group(1).strip()
    return None

# 実際のデータで抽出
gogyou_content = extract_gogyou_section(actual_raw_text)

if gogyou_content:
    print(f"抽出された五行セクション:")
    print(repr(gogyou_content))
    print()
    print(f"可視化:")
    print(gogyou_content)
    print()

    # 内容が2つ目のアイテムを含んでいるかチェック
    if "松浦 百花" in gogyou_content and "【" in gogyou_content:
        print("✅ 2つ目のアイテム（松浦 百花【...】）が含まれている")
    else:
        print("❌ 2つ目のアイテムが欠けている")
        print("理由：実際のraw_textに2つ目のアイテムが含まれていない")

    # 「松浦」で終わっているかチェック
    if gogyou_content.strip().endswith("松浦"):
        print("❌ 内容が「松浦」で途切れている")
        print("理由：元のraw_textが途中で切れている")
    else:
        print("✅ 内容は完全")

else:
    print("❌ 五行による鑑定セクションが見つからない")

print()
print("結論:")
print("問題はバックエンドの解析ロジックではなく、元のraw_textに2つ目のアイテムが含まれていないこと。")
print("つまり、実際の姓名判断サイトから取得されるデータが不完全。")