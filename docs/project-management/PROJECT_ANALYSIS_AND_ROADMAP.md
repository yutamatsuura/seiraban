# 鑑定書作成システム（sindankantei）- プロジェクト分析と開発ロードマップ

## 📊 プロジェクト概要

### システム構成
- **名称**: 星羅盤（せいらばん）- 鑑定書楽々作成ツール
- **目的**: 九星気学・姓名判断の鑑定書を自動作成するWebアプリケーション
- **技術スタック**:
  - Backend: FastAPI + SQLAlchemy 2.0 + PostgreSQL
  - Frontend: Vue.js 3 + TypeScript + Vite
  - 計算エンジン: JavaScript/TypeScript（既存システム連携）
  - デプロイ: Vercel/Netlify想定

### アーキテクチャ
```
┌─ Frontend (Vue.js) ─────┐    ┌─ Backend (FastAPI) ────┐    ┌─ 計算システム ──────┐
│ - Vue 3 + TypeScript    │    │ - REST API             │    │ - 九星気学           │
│ - Pinia Store          │◄──►│ - SQLAlchemy 2.0       │◄──►│ - 姓名判断           │
│ - Router               │    │ - PostgreSQL           │    │ - Puppeteer Bridge   │
└────────────────────────┘    └────────────────────────┘    └─────────────────────┘
```

## 🎯 現在の実装状況

### ✅ 実装済み機能

#### 1. **基本システム構造**
- FastAPI バックエンドサーバー（ポート8502）
- Vue.js フロントエンド（ポート3003）
- PostgreSQL データベース（Neon Cloud）
- 既存計算システム連携（九星気学・姓名判断）

#### 2. **鑑定機能（コア機能）**
- ✅ 新規鑑定書作成フォーム（`/Users/lennon/projects/inoue4/sindankantei/frontend/src/views/kantei/NewKanteiView.vue`）
- ✅ 九星気学計算（`system/kyuuseikigaku-kichihoui/`）
- ✅ 姓名判断計算（`system/seimeihandan/`）
- ✅ Puppeteer Bridge（`system/puppeteer_bridge_final.js`）
- ✅ 鑑定結果プレビュー（`/Users/lennon/projects/inoue4/sindankantei/frontend/src/views/kantei/PreviewView.vue`）
- ✅ PDF生成・ダウンロード機能

#### 3. **データ管理**
- ✅ PostgreSQL データベース（61ユーザー、40鑑定記録）
- ✅ 鑑定履歴管理
- ✅ データ永続化

#### 4. **UI/UX**
- ✅ レスポンシブデザイン
- ✅ 左メニューナビゲーション
- ✅ 統一されたスタイリング（SCSS）

### 🔶 部分実装・課題あり

#### 1. **認証システム**
- **状況**: 基本構造のみ実装、実際の認証機能は未実装
- **問題**:
  - ユーザー情報がハードコーディング（`'テストユーザー'`、`'管理者'`）
  - ログイン・ログアウト機能が動作しない
  - セッション管理未実装

#### 2. **テンプレート機能**
- **状況**: モックデータで動作
- **問題**:
  - 81パターンテキストテンプレートがモックデータ
  - PDF デザインテンプレート未実装
  - カスタマイズ機能未実装

#### 3. **メール機能**
- **状況**: モック実装のみ（**注意**: 本番では使用しない予定）
- **問題**:
  - SendGrid実装が`mock_sendgrid`
  - 実際のメール送信機能なし
  - 通知システム未実装
- **方針**: UTAGE決済システムでメール処理を行うため、当システムでのメール機能は実装しない

### ❌ 未実装機能

#### 1. **ユーザー管理**
- 新規ユーザー登録
- パスワードリセット
- アカウント設定変更
- 権限管理

#### 2. **UTAGE決済システム連携**
- UTAGE Webhook受信システム（決済完了通知）
- 決済完了後の自動アカウント作成
- メールアドレス＋共通パスワード認証システム

#### 3. **管理機能**
- 管理者ダッシュボード実装
- ユーザー管理画面
- システム設定

#### 4. **アドバンス機能**
- 鑑定書デザインカスタマイズ
- バルク処理
- データエクスポート機能
- API 外部連携

## 🔍 モックデータ・ハードコーディング箇所

### フロントエンド
1. **Sidebar.vue:98-99** - ユーザー情報ハードコーディング
   ```javascript
   const userName = computed(() => 'テストユーザー')
   const userRole = computed(() => '管理者')
   ```

2. **mockups/**ディレクトリ - デザインモックアップ

### バックエンド
1. **email_service.py:27,75-76** - メールプロバイダーモック
   ```python
   self.provider = "mock_sendgrid"
   if self.provider == "mock_sendgrid":
       return self._mock_send_email(...)
   ```

2. **template_service.py:283-362** - テンプレートデータモック
   ```python
   mock_templates = [...]  # 81パターンのモックデータ
   ```

3. **pdf.py:290-293** - PDF生成モック
   ```python
   mock_pdf_content = b"%PDF-1.4\n..."
   ```

4. **auth関連** - 認証機能の仮実装（TODO多数）

## 🚀 今後の開発ロードマップ

### Phase 1: 基盤整備（優先度：高）

#### 1.1 認証システム実装（2-3週間）
- [ ] 実際のログイン・ログアウト機能
- [ ] JWT認証実装
- [ ] セッション管理
- [ ] パスワードハッシュ化
- [ ] ユーザー登録フロー

#### 1.2 テンプレートシステム（2週間）
- [ ] 81パターンテキストテンプレート実装
- [ ] データベーステンプレート管理
- [ ] PDF デザインテンプレート基本実装

#### 1.3 メール機能（1週間）
- [ ] SendGrid実装
- [ ] メール通知システム
- [ ] テンプレートメール機能

### Phase 2: 機能拡張（優先度：中）

#### 2.1 管理機能（3週間）
- [ ] 管理者ダッシュボード実装
- [ ] ユーザー管理画面
- [ ] システム統計・レポート機能
- [ ] データ管理機能

#### 2.2 UX改善（2週間）
- [ ] エラーハンドリング強化
- [ ] ローディング状態改善
- [ ] バリデーション強化
- [ ] レスポンシブ最適化

#### 2.3 パフォーマンス最適化（1週間）
- [ ] データベースクエリ最適化
- [ ] キャッシュ機能
- [ ] バンドルサイズ最適化

### Phase 3: アドバンス機能（優先度：低）

#### 3.1 カスタマイズ機能（3-4週間）
- [ ] 鑑定書デザインカスタマイズ
- [ ] ユーザー独自テンプレート
- [ ] ブランディング機能

#### 3.2 UTAGE決済システム統合（2-3週間）
- [ ] UTAGE Webhookエンドポイント実装
- [ ] 決済完了時の自動アカウント作成
- [ ] パラメータ設定とWebhook設定（UTAGE側）
- [ ] メールアドレス＋共通パスワード認証

#### 3.3 エンタープライズ機能（4-5週間）
- [ ] バルク処理機能
- [ ] データエクスポート・インポート
- [ ] 監査ログ
- [ ] バックアップ・リストア

## 📋 技術的課題と解決策

### 1. **データベース設計**
- **課題**: 現在のスキーマが基本的
- **解決策**: より詳細なER図作成、正規化検討

### 2. **型安全性**
- **課題**: バックエンド-フロントエンド間の型一致
- **解決策**: OpenAPI自動生成、TypeScript型共有

### 3. **テスト**
- **課題**: テストカバレッジ不足
- **解決策**: 単体テスト・統合テスト強化

### 4. **デプロイ・CI/CD**
- **課題**: 本番環境構築未実装
- **解決策**: Docker化、GitHub Actions設定

## 💡 推奨次ステップ

### 即座に着手すべき項目
1. **認証システム実装** - ハードコーディング除去
2. **エラーハンドリング強化** - ユーザビリティ向上
3. **テンプレートシステム** - モックデータ除去
4. **テスト追加** - 品質保証

### 中期的な目標
1. **管理機能充実** - 実運用準備
2. **パフォーマンス最適化** - スケーラビリティ確保
3. **デプロイ自動化** - DevOps整備

### 長期的なビジョン
1. **エンタープライズ対応** - 大規模運用
2. **AI機能統合** - 自動化拡張
3. **モバイルアプリ** - マルチプラットフォーム展開

## 📝 メンテナンス・運用考慮事項

### モニタリング
- アプリケーションログ監視
- パフォーマンス監視
- エラー率監視

### セキュリティ
- 定期的脆弱性スキャン
- セキュリティパッチ適用
- アクセス制御強化

### バックアップ
- データベース定期バックアップ
- アプリケーション設定バックアップ
- 災害復旧計画

---

**作成日**: 2025年9月21日
**最終更新**: 2025年9月21日
**作成者**: Claude AI Assistant

このドキュメントは現在のプロジェクト状況の正確な把握と、今後の開発方針決定のための包括的な分析結果です。