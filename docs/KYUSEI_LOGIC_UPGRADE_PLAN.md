# 九星気学ロジック完全アップグレード計画書

## プロジェクト概要

**実施日**: 2025年09月25日
**目的**: Puppeteerスクレイピング方式から完全ロジック実装への移行
**影響範囲**: 九星気学・吉方位計算のみ（姓名判断は現状維持）

## 現状システム状況

### ✅ 解決済み問題
- CORS問題完全解決
- データベーススキーマ修正完了
- 認証機能修正完了
- ポート競合問題解決（3006/3007に移行）
- Node.js互換性問題解決
- 九星気学データ抽出問題解決

### 📊 現在の動作状況
- **姓名判断システム**: ✅ 完全動作
- **九星気学システム**: ✅ 基本動作（Puppeteerスクレイピング方式）
- **PDF/Word出力**: ✅ 完全動作
- **プレビュー表示**: ✅ 完全動作

## 新システム（kyuuseikigaku-kichihoui2）調査結果

### 💎 発見された完全実装
- **完全TypeScript実装**: 848KBの完全コンパイル済みJavaScript
- **d3.js完全統合**: 方位盤の美しい描画エンジン
- **Vue.js完全コンポーネント化**: モジュラー設計
- **完全ロジック**: 九星・吉方位・干支・暦計算の全て

### 🎯 新機能実装可能項目
1. **日付範囲対応**
   - 過去・未来の任意日付での計算
   - 年盤・月盤・日盤の完全対応
   - カレンダーUI付きユーザー選択

2. **方位盤描画**
   - d3.js SVGによる高品質描画
   - PDF: ベクター形式（無限拡大可能）
   - Word: 高解像度PNG画像

3. **高度な計算機能**
   - LocalDate完全実装（Java Time API準拠）
   - 干支60周期完全対応
   - 節季・節入り自動計算

## 技術的実装計画

### Phase 1: バックアップ・準備
- [x] 現状のGitコミット作成
- [x] ドキュメント整備
- [x] システム状況記録

### Phase 2: ロジック統合
- [ ] kyuuseikigaku-kichihoui2のロジック抽出
- [ ] FastAPI エンドポイント作成
- [ ] Node.js ブリッジ実装
- [ ] 九星計算API化

### Phase 3: フロントエンド統合
- [ ] Vue.js コンポーネント移植
- [ ] d3.js 方位盤描画統合
- [ ] 日付選択UI実装
- [ ] プレビュー画面改修

### Phase 4: 出力系統合
- [ ] PDF出力への方位盤統合
- [ ] Word出力への方位盤統合
- [ ] テンプレートシステム対応

### Phase 5: テスト・検証
- [ ] 既存データとの整合性確認
- [ ] 精度検証
- [ ] パフォーマンステスト
- [ ] ユーザビリティテスト

## リスク管理

### 🛡️ 安全対策
1. **完全バックアップ**: 実装前にGitタグ作成
2. **段階的移行**: フェーズ毎に動作確認
3. **ロールバック準備**: 問題時は即座に旧システム復旧
4. **並行稼働**: 一定期間は旧システム併用

### ⚠️ 想定リスク
- **データ精度差異**: 旧システムとの計算結果差分
- **パフォーマンス**: 複雑計算による処理速度低下
- **UI変更**: ユーザー操作フロー変更による混乱

### 🎯 成功指標
- **精度向上**: 計算精度99.9%以上
- **速度向上**: レスポンス時間50%短縮
- **機能拡張**: 日付選択・方位盤描画完全実装
- **品質向上**: PDF/Word出力に方位盤統合

## 実装スケジュール

### Week 1: 準備・設計
- システムバックアップ
- ロジック抽出・分析
- API設計

### Week 2: バックエンド実装
- Node.js ブリッジ作成
- FastAPI エンドポイント実装
- 計算ロジック統合

### Week 3: フロントエンド実装
- Vue.js コンポーネント移植
- d3.js 方位盤統合
- UI改修

### Week 4: 出力・テスト
- PDF/Word出力改修
- 総合テスト
- 品質検証

## 承認・実行

**📋 最終確認項目**:
- [x] システム現状記録完了
- [x] バックアップ計画確認
- [x] ロールバック手順確認
- [x] 新機能仕様確認

**🚀 実行承認**: 待機中
**実行責任者**: Claude Code Assistant
**品質管理**: 段階的検証による品質保証
**完了予定**: 2025年10月末