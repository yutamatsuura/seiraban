# 既存システム連携実装チェックリスト

他のエンジニアが同様のシステムを実装する際の必須チェック項目

## 📋 実装前チェック

### ✅ **環境準備**
- [ ] Node.js 18+ インストール済み
- [ ] Python 3.9+ インストール済み
- [ ] 既存鑑定システムが稼働中（通常 port 3002）
- [ ] 既存システムにアクセス可能 (`curl http://localhost:3002/`)

### ✅ **必須ファイル取得**
- [ ] `/system/puppeteer_bridge_final.js` - Puppeteer連携スクリプト
- [ ] `/system/package.json` + `/system/package-lock.json` - Node.js依存関係
- [ ] `/backend/main.py` - バックエンドサーバー（port 8502）
- [ ] `/backend/requirements.txt` - Python依存関係
- [ ] `/frontend/src/views/kantei/PreviewView.vue` - 結果表示画面
- [ ] `/frontend/src/services/api-client.ts` - API通信クライアント
- [ ] `/frontend/package.json` - フロントエンド依存関係

### ✅ **設定ファイル**
- [ ] `.env.local` - 環境変数（既存システムURL設定）
- [ ] `.ports.config` - ポート設定
- [ ] `vite.config.ts` - フロントエンドビルド設定

---

## 🔧 実装手順チェック

### ステップ1: 依存関係インストール
```bash
# Puppeteerシステム
cd system/ && npm install

# バックエンド
cd ../backend/ && pip install -r requirements.txt

# フロントエンド
cd ../frontend/ && npm install
```
- [ ] すべてのインストールエラーなし

### ステップ2: 設定確認
- [ ] `.env.local` で既存システムURL設定済み
- [ ] ポート競合なし（8502, 3000, 3002）
- [ ] 既存システムへの接続確認済み

### ステップ3: 核心機能コピー
- [ ] `extract_character_composition()` 関数をコピー（動的文字数対応）
- [ ] `extract_seimei_details()` 関数をコピー（詳細データ抽出）
- [ ] Puppeteer抽出ロジックをコピー（system/puppeteer_bridge_final.js）
- [ ] Vue.js表示コンポーネントをコピー（PreviewView.vue）

---

## 🎯 重要機能確認

### ✅ **可変長名前対応**
- [ ] 4文字以上の名前で正しく表示される
- [ ] 最大18文字（姓名各9文字）まで対応
- [ ] 例：「松蔭時 鶴太郎」（6文字）で全文字表示

### ✅ **データ抽出精度**
- [ ] 文字構成（文字・画数・五行・陰陽）が正確
- [ ] 格数情報の正確な抽出
- [ ] 天地による鑑定結果の抽出
- [ ] 既存システムと100%一致する結果

### ✅ **管理者機能**
- [ ] 管理者モード切り替えボタン表示
- [ ] 管理者モードOFF時：詳細データ非表示
- [ ] 管理者モードON時：raw_dataを含む全データ表示
- [ ] モード切り替え時のデータ再読み込み

---

## 🚨 必須テスト項目

### ✅ **基本動作テスト**
- [ ] 九星気学計算が正常動作
- [ ] 姓名判断計算が正常動作
- [ ] 短い名前（2-3文字）での表示
- [ ] 長い名前（6文字以上）での表示
- [ ] エラー時の適切なハンドリング

### ✅ **システム連携テスト**
- [ ] 既存システムからのデータ取得成功
- [ ] Puppeteerタイムアウトエラーなし
- [ ] 複数同時リクエストの処理
- [ ] ネットワーク切断時の回復

### ✅ **UI/UX テスト**
- [ ] レスポンシブデザイン対応
- [ ] ローディング状態の表示
- [ ] エラーメッセージの適切な表示
- [ ] 管理者モードの視覚的区別

---

## 📁 最終確認（渡すファイル）

### 🔴 **必須ファイル（13個）**
```
📁 system/
  ├── puppeteer_bridge_final.js
  ├── package.json
  └── package-lock.json

📁 backend/
  ├── main.py
  └── requirements.txt

📁 frontend/src/
  ├── views/kantei/PreviewView.vue
  ├── services/api-client.ts
  └── package.json

📁 設定ファイル/
  ├── .env.local
  ├── .ports.config
  ├── vite.config.ts
  └── docker-compose.yml
```

### 🟡 **推奨ファイル（5個）**
```
📁 frontend/src/
  ├── App.vue
  ├── main.ts
  └── router/index.ts

📁 ドキュメント/
  ├── EXISTING_SYSTEM_INTEGRATION.md  # 詳細実装ガイド
  └── IMPLEMENTATION_CHECKLIST.md     # このファイル
```

---

## 🔍 トラブルシューティングチェック

### ❌ **よくある問題**

#### **Puppeteerエラー**
- [ ] タイムアウト設定は適切か（30-60秒）
- [ ] 既存システムのレスポンス確認済み
- [ ] ヘッドレスモード設定確認

#### **文字抽出失敗**
- [ ] `extract_character_composition()` 関数の動作確認
- [ ] 正規表現パターンが既存システムに適合
- [ ] デバッグログで抽出データ確認

#### **表示崩れ**
- [ ] Vue.jsのv-forキー設定確認
- [ ] CSSスタイルの継承確認
- [ ] レスポンシブ対応確認

#### **API通信エラー**
- [ ] ポート競合の確認
- [ ] CORS設定の確認
- [ ] 環境変数読み込み確認

---

## ✅ 完成確認

### **最終動作確認**
1. [ ] 短い名前（3-4文字）での完全一致表示
2. [ ] 長い名前（6文字以上）での完全一致表示
3. [ ] 管理者モードの正常動作
4. [ ] エラー時の適切な処理
5. [ ] 既存システムとの結果100%一致

### **成功基準**
- ✅ 既存システムと全く同じ結果が表示される
- ✅ 可変長名前（最大18文字）に対応
- ✅ 管理者権限で詳細データ表示制御
- ✅ 安定したPuppeteer連携動作

---

## 📞 サポート

実装中に問題が発生した場合：

1. **デバッグログ確認**: main.py のコンソール出力をチェック
2. **ネットワーク確認**: 既存システムへの接続状況をチェック
3. **ファイル比較**: 動作しているシステムとの差分確認
4. **段階的テスト**: 各コンポーネントを個別にテスト

---

**このチェックリストを完了すれば、既存システム連携の実装が完成します！**